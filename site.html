<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interest Calculator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <style>
        .flash {
            background-color: rgba(255, 255, 0, 0.5);
            transition: background-color 0.5s ease;
        }
        .input-field input:focus + label, .input-field input.valid + label {
            color: #1565c0 !important;
        }
        .input-field input:focus, .input-field input.valid {
            border-bottom: 1px solid #1565c0 !important;
            box-shadow: 0 1px 0 0 #1565c0 !important;
        }
        .disabled-field {
            background-color: #f0f0f0 !important;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col s12 m8 offset-m2">
                <h3 class="center-align">Interest Calculator</h3>

                <!-- Radio Button Selection -->
                <div class="radio-container">
                    <p><b>Choose what to calculate:</b></p>
                    <label>
                        <input name="calculation" type="radio" value="principal" />
                        <span>Principal Amount</span>
                    </label>
                    <label>
                        <input name="calculation" type="radio" value="time" />
                        <span>Time (Years)</span>
                    </label>
                    <label>
                        <input name="calculation" type="radio" value="rate" />
                        <span>Interest Rate (%)</span>
                    </label>
                    <label>
                        <input name="calculation" type="radio" value="total" />
                        <span>Total Amount</span>
                    </label>
                </div>

                <!-- Input Fields -->
                <div class="input-field">
                    <input type="number" id="principal" class="validate">
                    <label for="principal">Principal Amount</label>
                </div>
                <div class="input-field">
                    <input type="number" id="time" class="validate">
                    <label for="time">Time (Years)</label>
                </div>
                <div class="input-field">
                    <input type="number" id="rate" class="validate">
                    <label for="rate">Compound Interest Rate (%)</label>
                </div>
                <div class="input-field">
                    <input type="number" id="total" class="validate">
                    <label for="total">Total Amount</label>
                </div>

                <!-- Action Buttons -->
                <button id="calculate" class="waves-effect waves-light btn blue">Calculate</button>
                <button id="reset" class="waves-effect waves-light btn grey">Reset</button>
                <button id="download" class="waves-effect waves-light btn green">Download CSV</button>
            </div>
        </div>
    </div>

    <!-- External JS Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.2/FileSaver.min.js"></script>

    <!-- JavaScript Code -->
    <script>
        // DOM Elements
        const principalInput = document.getElementById('principal');
        const timeInput = document.getElementById('time');
        const rateInput = document.getElementById('rate');
        const totalInput = document.getElementById('total');
        const calculateBtn = document.getElementById('calculate');
        const resetBtn = document.getElementById('reset');
        const downloadBtn = document.getElementById('download');

        let calculationTarget = null; // Track which field is being calculated

        // Disable the target field based on the selected calculation
        const updateDisabledField = () => {
            const inputs = [principalInput, timeInput, rateInput, totalInput];

            inputs.forEach(input => {
                input.classList.remove('disabled-field');
                input.disabled = false;
            });

            switch (calculationTarget) {
                case "principal":
                    principalInput.classList.add('disabled-field');
                    principalInput.disabled = true;
                    break;
                case "time":
                    timeInput.classList.add('disabled-field');
                    timeInput.disabled = true;
                    break;
                case "rate":
                    rateInput.classList.add('disabled-field');
                    rateInput.disabled = true;
                    break;
                case "total":
                    totalInput.classList.add('disabled-field');
                    totalInput.disabled = true;
                    break;
                default:
                    break;
            }
        };

        // Reinitialize floating labels after programmatically updating values
        const updateFloatingLabels = () => {
            M.updateTextFields();
        };

        // Radio Button Event Listener
        document.querySelectorAll('input[name="calculation"]').forEach(radio => {
            radio.addEventListener('change', function () {
                calculationTarget = this.value;
                updateDisabledField();
            });
        });

        const flashField = (field) => {
            field.classList.add('flash');
            setTimeout(() => field.classList.remove('flash'), 500);
        };

        const validateInputs = (inputs) => {
            for (let input of inputs) {
                if (input.value !== '' && parseFloat(input.value) <= 0) {
                    alert("All values must be positive numbers.");
                    return false;
                }
            }
            return true;
        };

        const calculate = () => {
            if (!calculationTarget) {
                alert("Please select an option to calculate.");
                return;
            }

            const principal = parseFloat(principalInput.value) || 0;
            const time = parseFloat(timeInput.value) || 0;
            const rate = parseFloat(rateInput.value) / 100 || 0;
            const total = parseFloat(totalInput.value) || 0;

            if (!validateInputs([principalInput, timeInput, rateInput, totalInput])) return;

            switch (calculationTarget) {
                case "principal":
                    if (rate > 0 && time > 0 && total > 0) {
                        principalInput.value = (total / Math.pow(1 + rate, time)).toFixed(2);
                        flashField(principalInput);
                    } else {
                        alert("Please provide valid Time, Rate, and Total Amount.");
                    }
                    break;
                case "time":
                    if (principal > 0 && rate > 0 && total > 0) {
                        timeInput.value = (Math.log(total / principal) / Math.log(1 + rate)).toFixed(2);
                        flashField(timeInput);
                    } else {
                        alert("Please provide valid Principal, Rate, and Total Amount.");
                    }
                    break;
                case "rate":
                    if (principal > 0 && time > 0 && total > 0) {
                        rateInput.value = ((Math.pow(total / principal, 1 / time) - 1) * 100).toFixed(2);
                        flashField(rateInput);
                    } else {
                        alert("Please provide valid Principal, Time, and Total Amount.");
                    }
                    break;
                case "total":
                    if (principal > 0 && rate > 0 && time > 0) {
                        totalInput.value = (principal * Math.pow(1 + rate, time)).toFixed(2);
                        flashField(totalInput);
                    } else {
                        alert("Please provide valid Principal, Time, and Rate.");
                    }
                    break;
                default:
                    alert("Invalid selection.");
            }

            updateFloatingLabels(); // Ensure labels float properly after updates
        };

        const resetInputs = () => {
            [principalInput, timeInput, rateInput, totalInput].forEach(input => {
                input.value = '';
                input.classList.remove('disabled-field');
                input.disabled = false;
            });
            document.querySelectorAll('input[name="calculation"]').forEach(radio => radio.checked = false);
            calculationTarget = null;
            updateFloatingLabels(); // Ensure labels reset correctly
        };

        calculateBtn.addEventListener('click', calculate);
        resetBtn.addEventListener('click', resetInputs);
    </script>
</body>
</html>